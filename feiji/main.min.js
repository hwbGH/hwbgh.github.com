function getRandomBetweenInt(t,e){try{var i=t;return e>t&&(i=t+(e-t)*Math.random()),parseInt(i)}catch(s){return 0}}function getRandomBetween(t,e){try{var i=t;return e>t&&(i=t+(e-t)*Math.random()),i}catch(s){return 0}}function onMouseDown(){Config.isPause=!1}function onLoading(t){}function onLoaded(){Laya.stage.removeChild(loading),Laya.stage.addChild(new GameScreen(0))}var Sprite=laya.display.Sprite,Text=laya.display.Text,Bitmap=laya.resource.Bitmap,Texture=laya.resource.Texture,Handler=laya.utils.Handler,Loader=laya.net.Loader,Animation=laya.display.Animation,Rectangle=laya.maths.Rectangle,Event=laya.events.Event,Pool=laya.utils.Pool,Browser=laya.utils.Browser,Stat=laya.utils.Stat,SoundManager=laya.media.SoundManager,Point=laya.maths.Point,Tween=laya.utils.Tween,LocalStorage=laya.net.LocalStorage,Socket=laya.net.Socket,Byte=laya.utils.Byte,Button=Laya.Button,Input=Laya.Input,Stage=laya.display.Stage,HttpRequest=laya.net.HttpRequest,WebGL=laya.webgl.WebGL,TimeLine=laya.utils.TimeLine,Label=laya.ui.Label,res={},res_sound={music_game:"res/music/game.mp3",sound_bullet:"res/sound/bullet.mp3",sound_fire:"res/sound/fire.mp3",sound_explode_plane:"res/sound/explode_plane.mp3"},Config={webServer:"ws://192.168.1.61:8080/ResinWebSocket/MyServlet?userId=",GameWidth:1280,GameHeight:720,GameWidthHalf:640,GameHeightHalf:360,bgSpeed:1,speed:8,SPEED_SLOW:8,SPEED_FAST:12,move_time:2e3,isPause:!1,isOver:!1,begin_x:300,begin_y:360,direction_none:-1,direction_up:0,direction_down:1,direction_left:2,direction_right:3,direction_number:4};!function(){function t(){this.moveCount=0,this.speedX=0,this.speedY=0,t.__super.call(this)}Laya["class"](t,"HurtText",Label);var e=t.prototype;t.create="create_hurtText",t.move_step=40,t.speed=2,t.interval=.01,t.angle=-Math.PI/2,t.angleMin=-Math.PI/4*3,t.angleMax=-Math.PI/4,e.init=function(e,i,s){this.color="#ff0000",this.fontSize=20,this.bold=!0,this.align="center",this.valign="middle",this.pos(e,i),this.changeText(s),this.visible=!0,this.moveCount=t.move_step;var a=getRandomBetween(t.angleMin,t.angleMax);this.speedX=t.speed*Math.cos(a),this.speedY=t.speed*Math.sin(a),Laya.timer.frameLoop(1,this,this.onLoop)},e.onLoop=function(){Config.isPause||Config.isOver||!this.visible||(this.moveCount--,this.x+=this.speedX,this.y+=this.speedY,this.moveCount<=0&&this.hide())},e.hide=function(){this.rotation=0,this.visible=!1,this.track=null,this.removeSelf(),Laya.Pool.recover("HurtText",this)}}(),function(){function Map(){this.id=0,this.screen=null,this.data=null,this.dataIndex=0,this.newTime=0}Laya["class"](Map,"my.Map");var _proto=Map.prototype;Map.load_over="map_load_over",_proto.init=function(t,e){this.id=t,this.screen=e,Laya.loader.load("res/map/"+t+".txt",Handler.create(this,this.onMapLoaded))},_proto.restart=function(){this.dataIndex=0,this.newTime=0,this.screen.onMapLoaded()},_proto.onMapLoaded=function(_data){this.data=eval(_data),this.restart()},_proto.checkEvent=function(t,e,i,s){var a=i-this.newTime;this.dataIndex>=0&&this.dataIndex<this.data.length&&a>=this.data[this.dataIndex].time&&(this.newTime>0&&enemyManager.isBoss(this.data[this.dataIndex].index)||enemyManager.createEnemy(t,e,this.data[this.dataIndex].index,s,this.data[this.dataIndex].number),this.dataIndex++),this.dataIndex>=this.data.length&&(this.newTime=i,this.dataIndex=0)}}(),function(){function t(){this.rocker_bg=null,this.rocker_round=null,this.rocker_round_h=null,this.dir_ctrl=null,this.dir_ctrl_h=null,this.defaultX=100,this.defaultY=Config.GameHeight-this.height-100,this.radius=1,this.widthHalf=1,this.heightHalf=1,t.__super.call(this),this.init()}Laya["class"](t,"Rocker",Sprite);var e=t.prototype;e.init=function(){this.alpha=.8,this.width=253,this.height=253,this.widthHalf=this.width/2,this.heightHalf=this.height/2,this.pos(this.defaultX,this.defaultY),this.rocker_bg=new Sprite,this.rocker_bg.loadImage("battle_ctrl/rocker_bg.png"),this.addChild(this.rocker_bg);var t=this.rocker_bg.getBounds(),e=t.width/2;this.rocker_bg.pivot(e,t.height/2),this.rocker_bg.pos(this.widthHalf,this.heightHalf),this.radius=e,this.rocker_round=new Sprite,this.rocker_round.loadImage("battle_ctrl/rocker_round.png"),this.addChild(this.rocker_round),t=this.rocker_round.getBounds(),this.rocker_round.pivot(t.width/2,t.height/2),this.rocker_round.pos(this.widthHalf,this.heightHalf),this.rocker_round_h=new Sprite,this.rocker_round_h.loadImage("battle_ctrl/rocker_round_h.png"),this.rocker_round_h.visible=!1,this.addChild(this.rocker_round_h),t=this.rocker_round_h.getBounds(),this.rocker_round_h.pivot(t.width/2,t.height/2),this.rocker_round_h.pos(this.widthHalf,this.heightHalf),this.dir_ctrl=new Sprite,this.dir_ctrl.loadImage("battle_ctrl/dir_ctrl.png"),this.addChild(this.dir_ctrl),t=this.dir_ctrl.getBounds(),this.dir_ctrl.pivot(t.width/2,t.height/2),this.dir_ctrl.pos(this.widthHalf,this.heightHalf),this.dir_ctrl_h=new Sprite,this.dir_ctrl_h.loadImage("battle_ctrl/dir_ctrl_h.png"),this.dir_ctrl_h.visible=!1,this.addChild(this.dir_ctrl_h),t=this.dir_ctrl_h.getBounds(),this.dir_ctrl_h.pivot(t.width/2,t.height/2),this.dir_ctrl_h.pos(this.widthHalf,this.heightHalf)},e.onRockerDown=function(){this.rocker_round.visible=!1,this.rocker_round_h.visible=!0,this.dir_ctrl.visible=!1,this.dir_ctrl_h.visible=!0},e.onRockerMove=function(t,e){this.dir_ctrl_h.pos(this.widthHalf+t,this.heightHalf+e)},e.onRockerUp=function(){this.rocker_round.visible=!0,this.rocker_round_h.visible=!1,this.dir_ctrl.visible=!0,this.dir_ctrl_h.visible=!1}}();var PlayerData={bullet_level:1};!function(){function t(){this.body=null,t.__super.call(this)}Laya["class"](t,"Explode",Sprite);var e=t.prototype;t.PLANE="bullet_plane",t.BULLET="bullet_bullet",t.cached=!1,e.init=function(e,i,s){this.visible=!0,t.cached||(t.cached=!0,laya.display.Animation.createFrames(["explode/explode0.png","explode/explode1.png","explode/explode2.png","explode/explode3.png","explode/explode4.png","explode/explode5.png","explode/explode6.png","explode/explode7.png","explode/explode8.png","explode/explode9.png","explode/explode10.png","explode/explode11.png","explode/explode12.png","explode/explode13.png","explode/explode14.png","explode/explode15.png","explode/explode16.png","explode/explode17.png"],t.PLANE),laya.display.Animation.createFrames(["explode/bullet0.png","explode/bullet1.png","explode/bullet2.png","explode/bullet3.png","explode/bullet4.png"],t.BULLET)),null==this.body&&(this.body=new laya.display.Animation,this.body.interval=50,this.addChild(this.body),this.body.on(laya.events.Event.COMPLETE,this,this.onPlayComplete)),this.pos(e,i),this.playAction(s),Laya.timer.frameLoop(1,this,this.onLoop)},e.onPlayComplete=function(){this.removeSelf(),Laya.Pool.recover("Explode",this)},e.playAction=function(t){this.body.play(0,!0,t);var e=this.body.getBounds();this.body.pivot(e.width/2,e.height/2)},e.onLoop=function(){}}(),function(){function t(e,i){this.action=null,this.body=null,this.collisionWidth=0,this.collisionHeight=0,this.speedX=0,this.speedY=0,this.nextX=0,this.nextY=0,this.hp=1e3,this.hp_limit=1e3,this.attack=10,this.defense=1,this.shootTime=0,this.missileTime=0,this.shootCd=e,this.missileCd=i;var s=new Animation;s.loadAtlas("res/atlas/shield.json"),s.interval=50,s.index=1,s.play(),this.shield=new Sprite,this.shield.addChild(s);var a=this.shield.getBounds();this.shield.pivot(a.width/2,a.height/2),this.shield.visible=!1,this.shieldTime=0,t.__super.call(this),this.init()}t.move_speed=10,t.shoot_cd=400,t.missile_cd=1e3,t.FLY="player_run",t.FIRE="player_fire",t.HURT="player_hurt",t.DIE="player_die",t.min_x=20,t.max_x=Config.GameWidth-20,t.min_y=20,t.max_y=Config.GameHeight-20,Laya["class"](t,"Player",Sprite);var e=t.prototype;t.cached=!1,e.init=function(){this.visible=!0,t.cached||(t.cached=!0,laya.display.Animation.createFrames(["player/palen0.png","player/palen1.png","player/palen2.png","player/palen3.png"],t.FLY)),null==this.body&&(this.body=new laya.display.Animation,this.body.interval=100,this.addChild(this.body)),this.addChild(this.shield),this.start(),Laya.timer.frameLoop(1,this,this.onLoop)},e.start=function(){this.hp=this.hp_limit,this.x=Config.begin_x,this.y=Config.begin_y,this.shootTime=Browser.now()+this.shootCd,this.missileTime=Browser.now()+this.missileCd,this.event(t.HURT,[this.hp,this.hp_limit]),this.playAction(t.FLY)},e.playAction=function(t){if(this.action!=t){this.action=t,this.body.play(0,!0,this.action);var e=this.body.getBounds();this.collisionWidth=e.width/2,this.collisionHeight=e.height/2,this.body.pivot(this.collisionWidth,this.collisionHeight),this.collisionWidth=e.width/2-20,this.collisionHeight=e.height/2-20}},e.onLoop=function(){if(!Config.isPause&&!Config.isOver){this.x+=this.speedX,this.x<t.min_x?this.x=t.min_x:this.x>t.max_x&&(this.x=t.max_x),this.y+=this.speedY,this.y<t.min_y?this.y=t.min_y:this.y>t.max_y&&(this.y=t.max_y);var e=Browser.now();this.shootTime<=e&&(this.shootTime=e+this.shootCd,this.event(t.FIRE,[BulletManager.type_player_default])),this.missileTime<=e&&(this.missileTime=e+this.missileCd,this.event(t.FIRE,[BulletManager.type_player_missile])),this.shieldTime<e&&(this.shield.visible=!1)}},e.playerMoveTo=function(t,e,i){var s=t-this.x,a=e-this.y;0==s&&(s=1);var h=Math.abs(Math.atan(a/s));this.speedX=i*Math.cos(h)*(0>s?-1:1),this.speedY=i*Math.sin(h)*(0>a?-1:1),this.nextX=t,this.nextY=e},e.playerMove=function(t,e){this.speedX=t,this.speedY=e},e.useShield=function(){this.shieldTime=Browser.now()+toolManager.getValue(ToolManager.id_shield),this.shield.visible=!0},e.collisionLogic=function(t,e){if(this.visible&&t.visible){var i=!1,s=Math.abs(this.x-t.x),a=Math.abs(this.y-t.y);if(s<this.collisionWidth+t.collisionWidth&&a<this.collisionHeight+t.collisionHeight){var h=t.attack-this.defense;0>=h&&(h=1),this.beHurt(h),t.hide(!0),this.hp<=0?e.addExplode(this.x,this.y,Explode.PLANE):e.addExplode(t.x,t.y,Explode.BULLET),i=!0}return i}},e.collisionLogicEnemy=function(t,e){var i=!1,s=Math.abs(this.x-t.x),a=Math.abs(this.y-t.y);if(s<this.collisionWidth+t.collisionWidth&&a<this.collisionHeight+t.collisionHeight){var h=t.attack-this.defense;0>=h&&(h=1),this.beHurt(h),h=this.attack-t.defense,0>=h&&(h=1),t.beHurt(h),(this.hp<=0||t.hp<=0)&&e.addExplode(this.x,this.y,Explode.PLANE,10),i=!0}return i},e.beHurt=function(e){this.shield.visible||(this.hp-=e,this.event(t.HURT,[this.hp,this.hp_limit]),this.event(HurtText.create,[this.x,this.y,e]),this.hp<0&&(this.hp=0,this.hide(),SoundManager.playSound(res_sound.sound_explode_plane)))},e.hide=function(){this.visible=!1,this.event(t.DIE)}}(),function(){function t(){this.classIndex=0,this.action=null,this.body=null,this.collisionWidth=0,this.collisionHeight=0,this.boundWidth=0,this.boundHeight=0,this.index=0,this.hp=1,this.hp_limit=1,this.attack=1,this.defense=0,this.shootTime=0,this.shootCd=99999999,this.speedX=0,this.speedY=0,this.radian=0,this.radianSpeed=0,t.__super.call(this)}t.CLASSID=0,t.FLY="enemy_run",t.FIRE="enemy_fire",t.DIE="enemy_die",Laya["class"](t,"Enemy",Sprite);var e=t.prototype;t.cached=!1,e.init=function(e,i,s,a,h,n,o,l,r){this.classIndex=t.CLASSID++,this.visible=!0,this.index=e,this.hp=a,this.attack=h,this.defense=n,this.shootCd=o,this.hp_limit=a,this.speedX=l,this.speedY=r,t.cached||(t.cached=!0,laya.display.Animation.createFrames(["enemy/0_0.png","enemy/0_1.png","enemy/0_2.png","enemy/0_3.png"],t.FLY+"0"),laya.display.Animation.createFrames(["enemy/1_0.png","enemy/1_1.png","enemy/1_2.png","enemy/1_3.png"],t.FLY+"1"),laya.display.Animation.createFrames(["enemy/100_0.png","enemy/100_1.png","enemy/100_2.png","enemy/100_3.png","enemy/100_4.png"],t.FLY+"100")),null==this.body&&(this.body=new laya.display.Animation,this.body.interval=100,this.addChild(this.body)),this.pos(i,s),this.shootTime=Browser.now()+this.shootCd,this.hurtTime=0,this.playAction(t.FLY+e),this.moveTween(),Laya.timer.frameLoop(1,this,this.onLoop)},e.playAction=function(t){if(this.action!=t){this.action=t,this.body.play(0,!0,this.action);var e=this.body.getBounds();this.boundWidth=e.width,this.boundHeight=e.height,this.collisionWidth=e.width/2,this.collisionHeight=e.height/2,this.body.pivot(this.collisionWidth,this.collisionHeight),this.collisionWidth=e.width/2-20,this.collisionHeight=e.height/2-20}},e.onLoop=function(){if(!Config.isPause&&!Config.isOver&&this.visible){this.move();var e=Browser.now();this.shootTime<=e&&(this.shootTime=e+this.shootCd,this.event(t.FIRE,this))}},e.moveTween=function(){switch(this.radian=0,this.radianSpeed=getRandomBetween(.001,.05),this.index){case EnemyManager.index_tween:}},e.move=function(){this.index==EnemyManager.index_line?(this.x+=this.speedX,this.y+=this.speedY,this.x<EnemyManager.min_x?this.hide():(this.y<EnemyManager.min_y||this.y>EnemyManager.max_y)&&(this.speedY=-this.speedY)):this.index==EnemyManager.index_tween?(this.x+=this.speedX,this.y+=this.speedY*Math.sin(this.radian),this.radian+=this.radianSpeed,this.x<EnemyManager.min_x||this.x>2*EnemyManager.max_x?this.hide():(this.y<EnemyManager.min_y||this.y>EnemyManager.max_y)&&(this.speedY=-this.speedY)):this.index>=EnemyManager.index_boss&&(this.x+=this.speedX,this.x<=EnemyManager.boss_x&&(this.speedX=0))},e.hide=function(){this.visible=!1,this.removeSelf(),Laya.Pool.recover("Enemy",this)},e.isDisregard=function(t){if(t.isBig()){var e=Browser.now();return this.hurtTime+BulletManager.hurtCd<=e?(this.hurtTime=e,!0):!1}return!1},e.collisionLogic=function(t,e){if(this.visible&&t.visible&&!this.isDisregard(t)){var i=Math.abs(this.x-t.x),s=Math.abs(this.y-t.y);if(t.isBig()||i<this.collisionWidth+t.collisionWidth&&s<this.collisionHeight+t.collisionHeight){var a=t.attack-this.defense;0>=a&&(a=1),this.beHurt(a),t.shouldHide()&&t.hide(!0),this.hp<=0?this.index>=EnemyManager.index_boss?(e.addExplode(this.x,this.y,Explode.PLANE,10),e.addExplode(this.x+50,this.y,Explode.PLANE,10),e.addExplode(this.x,this.y+50,Explode.PLANE,10),e.addExplode(this.x-50,this.y,Explode.PLANE,10),e.addExplode(this.x,this.y-50,Explode.PLANE,10)):e.addExplode(this.x,this.y,Explode.PLANE,0):e.addExplode(t.x,t.y,Explode.BULLET,0)}}},e.beHurt=function(e){this.hp-=e,this.event(HurtText.create,[this.x,this.y,e]),this.hp<0&&(this.hp=0,this.hide(),SoundManager.playSound(res_sound.sound_explode_plane),enemyManager.isBoss(this.index)&&this.event(t.DIE))}}(),function(){function t(){this.screen=null,this.camp=0,this.type=0,this.attack=1,this.speedX=0,this.speedY=0,this.action=null,this.body=null,this.collisionWidth=0,this.collisionHeight=0,this.track=null,this.trackClassId=-1,t.__super.call(this)}Laya["class"](t,"Bullet",Sprite);var e=t.prototype;t.FLY="bullet_move",t.FIRE="bullet_fire",t.DIE="bullet_die",t.cached=!1,e.init=function(e,i,s,a,h,n,o,l){this.screen=e,this.visible=!0,this.rotation=0,this.camp=a,t.cached||(t.cached=!0,laya.display.Animation.createFrames(["bullet/0_0.png"],t.FLY+"0_0"),laya.display.Animation.createFrames(["bullet/0_10_0.png","bullet/0_10_1.png"],t.FLY+"0_10"),laya.display.Animation.createFrames(["bullet/0_100_0.png","bullet/0_100_1.png","bullet/0_100_2.png","bullet/0_100_3.png","bullet/0_100_4.png","bullet/0_100_5.png","bullet/0_100_6.png"],t.FLY+"0_100"),laya.display.Animation.createFrames(["bullet/1_0.png"],t.FLY+"1_0"),laya.display.Animation.createFrames(["bullet/1_10.png"],t.FLY+"1_10")),null==this.body&&(this.body=new laya.display.Animation,a==BulletManager.camp_player&&h==BulletManager.type_player_big?this.body.interval=100:this.body.interval=50,this.addChild(this.body),this.body.on(laya.events.Event.COMPLETE,this,this.onPlayComplete)),this.pos(i,s),this.type=h,this.attack=n,this.speedX=o,this.speedY=l,this.playAction(t.FLY+a+"_"+h),Laya.timer.frameLoop(1,this,this.onLoop)},e.onPlayComplete=function(){this.action==t.FLY+BulletManager.camp_player+"_"+BulletManager.type_player_big&&this.hide()},e.playAction=function(t){this.action=t,this.body.play(0,!0,this.action);var e=this.body.getBounds();this.collisionWidth=e.width/2,this.collisionHeight=e.height/2,this.body.pivot(this.collisionWidth,this.collisionHeight)},e.onLoop=function(){if(!Config.isPause&&!Config.isOver&&this.visible){if(this.camp==BulletManager.camp_player)if(this.type==BulletManager.type_player_missile)if(this.track&&this.track.visible&&this.trackClassId==this.track.classIndex){var t=this.track.x-this.x,e=this.track.y-this.y;0==t&&(t=1);var i=Math.atan(e/t);this.rotation=180*i/Math.PI,this.speedX=BulletManager.speed_player_missile*Math.cos(i),this.speedY=BulletManager.speed_player_missile*Math.sin(i),0>t&&(this.speedX=-this.speedX,this.speedY=-this.speedY,this.rotation+=180),this.x+=this.speedX,this.y+=this.speedY}else this.x+=this.speedX,this.y+=this.speedY,this.screen.reTrack(this);else this.x+=this.speedX,this.y+=this.speedY;else this.x+=this.speedX,this.y+=this.speedY;(this.x<0||this.x>Config.GameWidth||this.y<0||this.y>Config.GameHeight)&&this.hide()}},e.hide=function(t){this.rotation=0,this.visible=!1,this.track=null,this.removeSelf(),Laya.Pool.recover("Bullet",this),t&&SoundManager.playSound(res_sound.sound_bullet)},e.setTrack=function(t){this.track=t,this.trackClassId=t.classIndex},e.isBig=function(){return this.type==BulletManager.type_player_big},e.shouldHide=function(){return this.type!=BulletManager.type_player_big}}(),function(){function t(e){this.state=0,this.bg1=null,t.__super.call(this),this.init(e)}t.state_move=0,t.state_stop=1,Laya["class"](t,"Background",Sprite);var e=t.prototype;e.init=function(t){var e=Laya.loader.getRes("res/bg/game"+t+".jpg");this.bg1=new Sprite,this.bg1.graphics.drawTexture(e,0,0),this.bg1.graphics.drawTexture(e,Config.GameWidth,0),this.addChild(this.bg1),this.onMove(),Laya.timer.frameLoop(1,this,this.onLoop)},e.onMove=function(){this.state=t.state_move},e.onStop=function(){this.state=t.state_stop},e.onLoop=function(){Config.isPause||Config.isOver||this.state==t.state_move&&(this.bg1.x-=Config.bgSpeed,this.bg1.x+Config.GameWidth<=0&&(this.bg1.x+=Config.GameWidth))}}(),function(){function t(){t.__super.call(this)}Laya["class"](t,"BackpackInfo",ui.BackpackUI);t.prototype}();var backpackInfo=new BackpackInfo;!function(){function t(){this.init()}Laya["class"](t,"ToolManager"),t.id_none=0,t.id_shield=1,t.index_skill=2,t.min_x=-20,t.max_x=Config.GameWidth+100,t.min_y=30,t.max_y=Config.GameHeight-30,t.boss_x=9*Config.GameWidth/10,t.boss_y=Config.GameHeightHalf,t.speed=3;var e=t.prototype;e.init=function(){},e.getValue=function(t){return 1e4}}();var toolManager=new ToolManager;!function(){function t(){this.init()}Laya["class"](t,"EnemyManager"),t.index_line=0,t.index_tween=1,t.index_boss=100,t.min_x=-20,t.max_x=Config.GameWidth+100,t.min_y=30,t.max_y=Config.GameHeight-30,t.boss_x=9*Config.GameWidth/10,t.boss_y=Config.GameHeightHalf,t.speed=3;var e=t.prototype;e.init=function(){},e.createEnemy=function(e,i,s,a,h){var n=t.max_x,o=getRandomBetweenInt(0,Config.GameHeight),l=10+10*a,r=5+3*a,d=1+a,p=99999999,c=-t.speed,y=0;s==t.index_line?(p=1500,c=-t.speed):s==t.index_tween?(o=getRandomBetweenInt(Config.GameHeightHalf/3,Config.GameHeight-Config.GameHeightHalf/3),c=-t.speed,y=o<Config.GameHeightHalf?t.speed:-t.speed):s>=t.index_boss&&(l=1e3+100*a,r=10+7*a,d=3+3*a,p=3e3-20*a,1e3>p&&(p=1e3),c=-t.speed,o=t.boss_y);var u=null,g=1;o>Config.GameHeightHalf&&(g=-1);for(var m=0;h>m;m++)switch(u=Pool.getItemByClass("Enemy",Enemy),u.init(s,n,o,l,r,d,p,c,y),u.on(Enemy.FIRE,e,e.enemyFire),u.on(HurtText.create,e,e.createHurtText),u.on(Enemy.DIE,e,e.gameWin),i.addChild(u),s){case t.index_line:o+=(u.boundHeight+5)*g;break;case t.index_tween:n+=u.boundWidth+5}},e.isBoss=function(e){return e>=t.index_boss}}();var enemyManager=new EnemyManager;!function(){function t(){this.init()}Laya["class"](t,"BulletManager"),t.hurtCd=50,t.type_none=-1,t.type_player_default=0,t.type_player_missile=10,t.type_player_big=100,t.type_enemy_default=0,t.type_enemy_boss=10,t.camp_player=0,t.camp_enemy=1,t.speed_player=11,t.speed_player_missile=20,t.speed_enemy=5;var e=t.prototype;e.init=function(){},e.createBulletPlayer=function(e,i,s,a,h,n,o,l){var r=t.speed_player,d=0,p=null;if(a==t.type_player_missile){l+=l,p=Pool.getItemByClass("Bullet",Bullet);for(var c=0,y=0,u=null,g=Config.GameWidth*Config.GameHeight,m=0,_=0;_<s.numChildren;_++){var f=s.getChildAt(_);c=f.x-n,y=f.y-o,m=c*c+y*y,f.visible&&f.x>n&&g>m&&(g=m,u=f)}u&&p.setTrack(u),p.init(e,n,o,t.camp_player,a,l,r,d),i.addChild(p)}else if(a==t.type_player_big)r=0,n+=500,p=Pool.getItemByClass("Bullet",Bullet),p.init(e,n,o,t.camp_player,a,l,r,d),i.addChild(p);else for(var x=Math.PI/36,b=parseInt(h/2)*x-(h%2==0?x/2:0),v=0;h>v;v++)p=Pool.getItemByClass("Bullet",Bullet),p.init(e,n,o,t.camp_player,a,l,t.speed_player*Math.cos(b),t.speed_player*Math.sin(b)),i.addChild(p),b-=x},e.createBulletEnemy=function(e,i,s,a,h,n,o,l){var r=null,d=t.type_enemy_default,p=0;if(s==EnemyManager.index_line){var c=o-a,y=l-h;0==c&&(c=1),p=Math.abs(Math.atan(y/c)),r=Pool.getItemByClass("Bullet",Bullet),r.init(e,a,h,t.camp_enemy,d,n,t.speed_enemy*Math.cos(p)*(0>c?-1:1),t.speed_enemy*Math.sin(p)*(0>y?-1:1)),r.rotation=180*p/Math.PI,c>0&&0>y?r.rotation=-r.rotation:0>c&&(0>y?r.rotation=r.rotation-180:r.rotation=180-r.rotation),i.addChild(r)}else if(s>=EnemyManager.index_boss){d=t.type_enemy_boss;var u=Math.PI/18,g=11;p=parseInt(g/2)*u-(g%2==0?u/2:0);for(var m=0;g>m;m++)r=Pool.getItemByClass("Bullet",Bullet),r.init(e,a,h,t.camp_enemy,d,n,-t.speed_enemy*Math.cos(p),t.speed_enemy*Math.sin(p)),i.addChild(r),p-=u}}}();var bulletManager=new BulletManager;!function(){function t(){this.bg=null,this.txt=null,t.__super.call(this),this.init()}Laya["class"](t,"Loading",laya.display.Sprite);var e=t.prototype;e.init=function(){this.bg=new Sprite,this.bg.graphics.drawRect(0,0,Config.GameWidth,Config.GameHeight,"#000000"),this.addChild(this.bg),this.txt=new Text,this.txt.color="#ffffff",this.txt.fontSize=30,this.txt.text="Loading",this.txt.width=Config.GameWidth,this.txt.align="center",this.txt.y=.5*(Config.GameHeight-this.txt.height),this.addChild(this.txt)},e.progress=function(t){this.txt.text="Loading "+parseInt(100*t)+"%"}}(),Laya.init(Config.GameWidth,Config.GameHeight,Laya.WebGL),Laya.stage.scaleMode=Stage.SCALE_EXACTFIT,Laya.stage.alignH="center",Laya.stage.screenMode="horizontal";var loading=new Loading;Laya.stage.addChild(loading);var asset=[];asset.push({url:["res/bg/game0.jpg"],type:Laya.Loader.IMAGE}),asset.push({url:"res/atlas/player.json",type:Laya.Loader.ATLAS},{url:"res/atlas/bullet.json",type:Laya.Loader.ATLAS},{url:"res/atlas/enemy.json",type:Laya.Loader.ATLAS},{url:"res/atlas/explode.json",type:Laya.Loader.ATLAS},{url:"res/atlas/shield.json",type:Laya.Loader.ATLAS},{url:"res/atlas/battle_ctrl.json",type:Laya.Loader.ATLAS},{url:"res/atlas/ui.json",type:Laya.Loader.ATLAS}),asset.push({url:res_sound.music_game,type:Laya.Loader.SOUND}),Laya.loader.load(asset,Handler.create(this,onLoaded),Handler.create(this,onLoading,null,!1)),function(){function t(e){this.bg=null,this.level=e,this.state=0,this.player=null,this.enemys=null,this.bullet_player=null,this.bullet_enemy=null,this.hurtTexts=null,this.explodes=null,this.scoreTxt=null,this.score=0,this.map=null,this.mapIndex=0,this.gameTime=0,this.lastTime=0,this.shock=0,this.rocker=null,this.gameUi=null,t.__super.call(this),this.init()}t.state_none=0,t.state_load=1,t.state_game=2,t.state_pause=3,t.state_win=4,t.state_fail=5,t.state_exit=6,Laya["class"](t,"GameScreen",laya.display.Sprite);var e=t.prototype;e.init=function(){this.setState(t.state_load),this.bg=new Background(0),this.addChild(this.bg),this.player=new Player(Player.shoot_cd,Player.missile_cd),this.player.on(Player.DIE,this,this.gameOver),this.player.on(Player.FIRE,this,this.playerFire),this.player.on(Player.HURT,this,this.playerHurt),this.player.on(HurtText.create,this,this.createHurtText),this.addChild(this.player),this.enemys=new Sprite,this.addChild(this.enemys),this.bullet_enemy=new Sprite,this.addChild(this.bullet_enemy),this.bullet_player=new Sprite,this.addChild(this.bullet_player),this.explodes=new Sprite,this.addChild(this.explodes),this.hurtTexts=new Sprite,this.addChild(this.hurtTexts),this.scoreTxt=new Text,this.scoreTxt.color="#ffffff",this.scoreTxt.fontSize=30,this.scoreTxt.text="0",this.scoreTxt.width=Config.GameWidth,this.scoreTxt.align="right",this.scoreTxt.x=-10,this.scoreTxt.y=10,this.addChild(this.scoreTxt),this.gameUi=new ui.GameUI,this.gameUi.button_shield.on(laya.events.Event.MOUSE_DOWN,this,this.useTool,[ToolManager.id_shield]),this.gameUi.button_skill.on(laya.events.Event.MOUSE_DOWN,this,this.useTool,[ToolManager.index_skill]),this.addChild(this.gameUi),this.rocker=new Rocker,this.addChild(this.rocker),this.rocker.visible=!1,this.on(laya.events.Event.MOUSE_DOWN,this,this.onMouseDown),this.on(laya.events.Event.MOUSE_UP,this,this.onMouseUp),SoundManager.playMusic(res_sound.music_game),this.map=new my.Map,this.map.init(this.level,this)},e.onMapLoaded=function(){Laya.timer.frameLoop(1,this,this.onLoop),this.setState(t.state_game)},e.reset=function(){this.player.start(),this.enemys.removeChildren(0,this.enemys.numChildren),this.bullet_player.removeChildren(0,this.bullet_player.numChildren),this.bullet_enemy.removeChildren(0,this.bullet_enemy.numChildren),this.explodes.removeChildren(0,this.explodes.numChildren),this.hurtTexts.removeChildren(0,this.hurtTexts.numChildren)},e.restart=function(){this.reset(),this.map.restart()},e.nextMap=function(){this.reset(),this.level++,this.map.init(this.level,this)},e.setState=function(e){switch(e){case t.state_game:this.shock=0,this.lastTime=Browser.now()}this.state=e},e.onLoop=function(){switch(this.shock>0&&(this.shock%2==0?(this.bg.x=5,this.bg.y=5):(this.bg.x=-5,this.bg.y=-5),this.shock--,0==this.shock&&(this.bg.x=0,this.bg.y=0)),this.state){case t.state_game:var e=Browser.now();this.gameTime+=e-this.lastTime,this.lastTime=e,this.map.checkEvent(this,this.enemys,this.gameTime,this.level);var i=0,s=0,a=null;for(i=0;i<this.bullet_player.numChildren;i++)for(s=this.enemys.numChildren-1;s>-1;s--)if(a=this.bullet_player.getChildAt(i),this.enemys.getChildAt(s).collisionLogic(a,this),!a.visible){i--;break}for(i=0;i<this.bullet_enemy.numChildren;i++)if(this.player.collisionLogic(this.bullet_enemy.getChildAt(i),this)&&i--,!this.player.visible)return;for(s=0;s<this.enemys.numChildren;s++)if(this.player.collisionLogicEnemy(this.enemys.getChildAt(s),this),!this.player.visible)return}},e.addExplode=function(t,e,i,s){var a=Pool.getItemByClass("Explode",Explode);a.init(t,e,i),this.explodes.addChild(a),this.shock+=s},e.onMouseDown=function(){this.rocker.visible=!0;var t=Laya.stage.mouseX,e=Laya.stage.mouseY;this.rocker.pos(t-this.rocker.widthHalf,e-this.rocker.heightHalf),this.onRockerDown()},e.onMouseUp=function(){this.rocker.visible=!1},e.onRockerDown=function(){this.rocker.on(Event.MOUSE_MOVE,this,this.onRockerMove),this.rocker.on(Event.MOUSE_UP,this,this.onRockerUp),this.rocker.on(Event.MOUSE_OUT,this,this.onRockerUp),this.rocker.onRockerDown();var t=Laya.stage.mouseX,e=Laya.stage.mouseY;this.playerMove(t,e)},e.onRockerMove=function(){var t=Laya.stage.mouseX,e=Laya.stage.mouseY;this.playerMove(t,e)},e.onRockerUp=function(){this.rocker.off(Event.MOUSE_MOVE,this,this.onRockerMove),this.rocker.off(Event.MOUSE_UP,this,this.onRockerUp),this.rocker.off(Event.MOUSE_OUT,this,this.onRockerUp),this.rocker.onRockerUp(),this.player.playerMove(0,0)},e.playerMove=function(t,e){var i=t-this.rocker.x-this.rocker.widthHalf,s=e-this.rocker.y-this.rocker.heightHalf;0==i&&(i=1);var a=Math.sqrt(i*i+s*s);a>this.rocker.radius&&(a=this.rocker.radius);var h=Math.abs(Math.atan(s/i));this.rocker.onRockerMove(a*Math.cos(h)*(0>i?-1:1),a*Math.sin(h)*(0>s?-1:1));var n=Player.move_speed*a/this.rocker.radius,o=n*Math.cos(h)*(0>i?-1:1),l=n*Math.sin(h)*(0>s?-1:1);this.player.playerMove(o,l)},e.onBlur=function(){Config.isPause=!0},e.onFocus=function(){Config.isPause=!1},e.gameOver=function(){Config.isOver=!0,this.setState(t.state_fail)},e.gameWin=function(){this.setState(t.state_win)},e.playerFire=function(e){this.state==t.state_game&&(bulletManager.createBulletPlayer(this,this.bullet_player,this.enemys,e,PlayerData.bullet_level,this.player.x+this.player.collisionWidth,this.player.y,this.player.attack),e==BulletManager.type_player_missile?SoundManager.playSound(res_sound.sound_bullet):SoundManager.playSound(res_sound.sound_bullet))},e.playerHurt=function(t,e){0>t?t=0:t>e&&(t=e),this.gameUi.hp_bar.scale(t/e,1)},e.enemyFire=function(e){this.state==t.state_game&&bulletManager.createBulletEnemy(this,this.bullet_enemy,e.index,e.x-e.collisionWidth,e.y,e.attack,this.player.x,this.player.y)},e.reTrack=function(t){for(var e=0,i=0,s=null,a=Config.GameWidth*Config.GameHeight,h=0,n=0;n<this.enemys.numChildren;n++){var o=this.enemys.getChildAt(n);e=o.x-t.x,i=o.y-t.y,h=e*e+i*i,o.visible&&o.x>t.x&&a>h&&(a=h,s=o)}s&&t.setTrack(s)},e.useTool=function(t,e){switch(e.stopPropagation(),t){case ToolManager.id_shield:this.player.useShield();break;case ToolManager.index_skill:bulletManager.createBulletPlayer(this,this.bullet_player,this.enemys,BulletManager.type_player_big,PlayerData.bullet_level,this.player.x+this.player.collisionWidth,this.player.y,this.player.attack),this.shock+=40}},e.createHurtText=function(t,e,i){var s=Pool.getItemByClass("HurtText",HurtText);s.init(t,e,"-"+i),this.hurtTexts.addChild(s)}}();